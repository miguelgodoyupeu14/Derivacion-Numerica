<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derivadas Num√©ricas - Calculadora Robusta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: #3498db;
            color: white;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
        }
        
        .nav-tab.active:hover {
            background: #2980b9;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .math-input-container {
            position: relative;
        }
        
        .math-preview {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px 12px;
            font-size: 1.1em;
            color: #2c3e50;
            background: transparent;
            pointer-events: none;
            font-family: 'Times New Roman', serif;
            min-height: 42px;
            display: flex;
            align-items: center;
            z-index: 1;
        }
        
        .math-input-container input {
            position: relative;
            z-index: 2;
            background: transparent;
            color: transparent;
            caret-color: #2c3e50;
        }
        
        .math-input-container input:focus {
            background: transparent;
            color: transparent;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .results {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            min-height: 100px;
        }
        
        .result-title {
            color: #2c3e50;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .result-value {
            background: #e8f6f3;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .steps {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        
        .steps h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .step {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }
        
        .step:last-child {
            border-bottom: none;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .interpolation-points {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .point-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .point-input input {
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        
        .add-point, .remove-point {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        
        .add-point {
            background: #27ae60;
            color: white;
        }
        
        .remove-point {
            background: #e74c3c;
            color: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .method-description {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .method-description h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .method-description p {
            color: #424242;
            line-height: 1.6;
        }
        
        #math-field {
            min-height: 50px;
            border: 1px solid #ced4da;
            padding: 10px;
            border-radius: 5px;
        }
        
        #virtual-keyboard,
        .keyboard-container {
            margin-top: 15px;
            background: #2a2d35;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #1a1c23;
        }
        
        .keyboard-section {
            margin-bottom: 8px;
            background: #33373f;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #404550;
        }
        
        .keyboard-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #3a3e47;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }
        
        .keyboard-section-header:hover {
            background: #42464f;
        }
        
        .keyboard-section-title {
            font-size: 0.75em;
            font-weight: 600;
            color: #b8bcc5;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .keyboard-section-toggle {
            color: #888;
            font-size: 0.9em;
            transition: transform 0.3s;
        }
        
        .keyboard-section-toggle.collapsed {
            transform: rotate(-90deg);
        }
        
        .keyboard-section-content {
            padding: 8px;
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .keyboard-section-content.collapsed {
            max-height: 0;
            padding: 0 8px;
        }
        
        .keyboard-row {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
            margin-bottom: 4px;
        }
        
        .keyboard-row:last-child {
            margin-bottom: 0;
        }
        
        .key-btn {
            padding: 8px 4px;
            font-size: 0.85em;
            border: 1px solid #4a4e57;
            background: #4f5461;
            color: #e8eaed;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.15s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .key-btn:hover {
            background: #5a5f6d;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            border-color: #6a6f7d;
        }
        
        .key-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .key-btn.number {
            background: #5a5f6d;
            border-color: #656a78;
        }
        
        .key-btn.number:hover {
            background: #656a78;
        }
        
        .key-btn.operator {
            background: #6b6f7d;
            border-color: #787c8a;
            font-weight: 600;
        }
        
        .key-btn.operator:hover {
            background: #787c8a;
        }
        
        .key-btn.function {
            background: #4a5568;
            border-color: #5a6578;
            color: #cbd5e0;
        }
        
        .key-btn.function:hover {
            background: #5a6578;
        }
        
        .key-btn.variable {
            background: #4a5d6b;
            border-color: #5a6d7b;
            color: #a8d8ea;
            font-weight: 600;
            font-style: italic;
        }
        
        .key-btn.variable:hover {
            background: #5a6d7b;
            color: #c8e8fa;
        }
        
        .key-btn.special {
            background: #6b5a4a;
            border-color: #7b6a5a;
            color: #f0e5d8;
        }
        
        .key-btn.special:hover {
            background: #7b6a5a;
        }
        
        .key-btn.constant {
            background: #5a4d6b;
            border-color: #6a5d7b;
            color: #dac8ea;
        }
        
        .key-btn.constant:hover {
            background: #6a5d7b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ Derivadas Num√©ricas</h1>
            <p>Calculadora robusta para m√©todos de diferencias finitas, interpolaci√≥n y extrapolaci√≥n de Richardson</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('diferencias')">Diferencias Finitas</button>
            <button class="nav-tab" onclick="showTab('richardson')">Richardson</button>
            <button class="nav-tab" onclick="showTab('interpolacion')">Interpolaci√≥n</button>
        </div>
        
        <div class="content">
            <!-- TAB: DIFERENCIAS FINITAS -->
            <div id="diferencias" class="tab-content active">
                <div class="method-description">
                    <h3>Diferencias Finitas</h3>
                    <p>Calcula derivadas num√©ricas usando aproximaciones por diferencias finitas. Incluye m√©todos hacia adelante, hacia atr√°s y centrada, con comparaci√≥n autom√°tica con la derivada exacta.</p>
                </div>
                
                <div class="form-section">
                    <form id="diferenciasForm">
                        <div class="form-group">
                            <label for="df_funcion">Funci√≥n f(x):</label>
                            <div class="math-input-container">
                                <div id="math-preview" class="math-preview">x¬≤</div>
                                <input type="text" id="df_funcion" class="form-control" placeholder="Ej: x**2 + sin(x)" value="x**2" oninput="updateMathPreview()">
                            </div>
                            <div id="virtual-keyboard">
                                <!-- Secci√≥n: B√°sicos -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">B√°sicos</span>
                                        <span class="keyboard-section-toggle">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbol('7')">7</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('8')">8</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('9')">9</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('/')">√∑</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('**')">^</button>
                                            <button type="button" class="key-btn" onclick="insertSymbol('(')">(</button>
                                            <button type="button" class="key-btn" onclick="insertSymbol(')')">)</button>
                                            <button type="button" class="key-btn special" onclick="clearInput()">C</button>
                                            <button type="button" class="key-btn special" onclick="deleteChar()">‚å´</button>
                                            <button type="button" class="key-btn" onclick="insertSymbol(' ')">‚ê£</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbol('4')">4</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('5')">5</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('6')">6</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('*')">√ó</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('**2')">x¬≤</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('**3')">x¬≥</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('sqrt(')">‚àö</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('abs(')">|x|</button>
                                            <button type="button" class="key-btn constant" onclick="insertSymbol('pi')">œÄ</button>
                                            <button type="button" class="key-btn constant" onclick="insertSymbol('E')">e</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbol('1')">1</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('2')">2</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('3')">3</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('-')">-</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('**(')">x‚Åø</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('**(1/')">‚Åø‚àö</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('exp(')">e^x</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('log(')">ln</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('log10(')">log‚ÇÅ‚ÇÄ</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('factorial(')">n!</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbol('0')">0</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('00')">00</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbol('.')">.</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbol('+')">+</button>
                                            <button type="button" class="key-btn variable" onclick="insertSymbol('x')">x</button>
                                            <button type="button" class="key-btn variable" onclick="insertSymbol('y')">y</button>
                                            <button type="button" class="key-btn variable" onclick="insertSymbol('z')">z</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('floor(')">‚åäx‚åã</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('ceil(')">‚åàx‚åâ</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('sign(')">sgn</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Secci√≥n: Trigonom√©tricas -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">Trigonom√©tricas</span>
                                        <span class="keyboard-section-toggle collapsed">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content collapsed">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn function" onclick="insertSymbol('sin(')">sin</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('cos(')">cos</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('tan(')">tan</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('sec(')">sec</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('csc(')">csc</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('cot(')">cot</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Secci√≥n: Trig. Inversas -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">Trig. Inversas</span>
                                        <span class="keyboard-section-toggle collapsed">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content collapsed">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn function" onclick="insertSymbol('asin(')">arcsin</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('acos(')">arccos</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('atan(')">arctan</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('asec(')">arcsec</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('acsc(')">arccsc</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('acot(')">arccot</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Secci√≥n: Hiperb√≥licas -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">Hiperb√≥licas</span>
                                        <span class="keyboard-section-toggle collapsed">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content collapsed">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn function" onclick="insertSymbol('sinh(')">sinh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('cosh(')">cosh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('tanh(')">tanh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('asinh(')">arcsinh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('acosh(')">arccosh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbol('atanh(')">arctanh</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="df_x">Punto x:</label>
                                <input type="number" id="df_x" class="form-control" step="any" value="2">
                            </div>
                            <div class="form-group">
                                <label for="df_h">Paso h:</label>
                                <input type="number" id="df_h" class="form-control" step="any" value="0.00001">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="df_metodo">M√©todo:</label>
                                <select id="df_metodo" class="form-control">
                                    <option value="centrada">Diferencia Centrada</option>
                                    <option value="adelante">Diferencia Hacia Adelante</option>
                                    <option value="atras">Diferencia Hacia Atr√°s</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="df_orden">Orden de la derivada:</label>
                                <select id="df_orden" class="form-control">
                                    <option value="1">Primera derivada</option>
                                    <option value="2">Segunda derivada</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn">Calcular Diferencias Finitas</button>
                    </form>
                </div>
                
                <div id="diferenciasResults" class="results" style="display: none;"></div>
            </div>
            
            <!-- TAB: RICHARDSON -->
            <div id="richardson" class="tab-content">
                <div class="method-description">
                    <h3>Extrapolaci√≥n de Richardson</h3>
                    <p>Mejora la precisi√≥n de las derivadas num√©ricas usando extrapolaci√≥n de Richardson. Este m√©todo reduce el error de truncamiento de manera sistem√°tica.</p>
                </div>
                
                <div class="form-section">
                    <form id="richardsonForm">
                        <div class="form-group">
                            <label for="r_funcion">Funci√≥n f(x):</label>
                            <div class="math-input-container">
                                <div id="r_math-preview" class="math-preview">ln(x)</div>
                                <input type="text" id="r_funcion" class="form-control" placeholder="Ej: x**3 + 2*x**2 - x + 1" value="log(x)" oninput="updateMathPreview('r_funcion', 'r_math-preview')">
                            </div>
                            <div id="virtual-keyboard-richardson" class="keyboard-container">
                                <!-- Secci√≥n: B√°sicos -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">B√°sicos</span>
                                        <span class="keyboard-section-toggle">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '7')">7</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '8')">8</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '9')">9</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '/')">√∑</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '**')">^</button>
                                            <button type="button" class="key-btn" onclick="insertSymbolTo('r_funcion', '(')">(</button>
                                            <button type="button" class="key-btn" onclick="insertSymbolTo('r_funcion', ')')">)</button>
                                            <button type="button" class="key-btn special" onclick="clearInputFor('r_funcion')">C</button>
                                            <button type="button" class="key-btn special" onclick="deleteCharFrom('r_funcion')">‚å´</button>
                                            <button type="button" class="key-btn" onclick="insertSymbolTo('r_funcion', ' ')">‚ê£</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '4')">4</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '5')">5</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '6')">6</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '*')">√ó</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '**2')">x¬≤</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '**3')">x¬≥</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'sqrt(')">‚àö</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'abs(')">|x|</button>
                                            <button type="button" class="key-btn constant" onclick="insertSymbolTo('r_funcion', 'pi')">œÄ</button>
                                            <button type="button" class="key-btn constant" onclick="insertSymbolTo('r_funcion', 'E')">e</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '1')">1</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '2')">2</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '3')">3</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '-')">-</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '**(')">x‚Åø</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '**(1/')">‚Åø‚àö</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'exp(')">e^x</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'log(')">ln</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'log10(')">log‚ÇÅ‚ÇÄ</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'factorial(')">n!</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '0')">0</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '00')">00</button>
                                            <button type="button" class="key-btn number" onclick="insertSymbolTo('r_funcion', '.')">.</button>
                                            <button type="button" class="key-btn operator" onclick="insertSymbolTo('r_funcion', '+')">+</button>
                                            <button type="button" class="key-btn variable" onclick="insertSymbolTo('r_funcion', 'x')">x</button>
                                            <button type="button" class="key-btn variable" onclick="insertSymbolTo('r_funcion', 'y')">y</button>
                                            <button type="button" class="key-btn variable" onclick="insertSymbolTo('r_funcion', 'z')">z</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'floor(')">‚åäx‚åã</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'ceil(')">‚åàx‚åâ</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'sign(')">sgn</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Secci√≥n: Trigonom√©tricas -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">Trigonom√©tricas</span>
                                        <span class="keyboard-section-toggle collapsed">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content collapsed">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'sin(')">sin</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'cos(')">cos</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'tan(')">tan</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'sec(')">sec</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'csc(')">csc</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'cot(')">cot</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Secci√≥n: Trig. Inversas -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">Trig. Inversas</span>
                                        <span class="keyboard-section-toggle collapsed">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content collapsed">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'asin(')">arcsin</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'acos(')">arccos</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'atan(')">arctan</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'asec(')">arcsec</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'acsc(')">arccsc</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'acot(')">arccot</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Secci√≥n: Hiperb√≥licas -->
                                <div class="keyboard-section">
                                    <div class="keyboard-section-header" onclick="toggleSection(this)">
                                        <span class="keyboard-section-title">Hiperb√≥licas</span>
                                        <span class="keyboard-section-toggle collapsed">‚ñº</span>
                                    </div>
                                    <div class="keyboard-section-content collapsed">
                                        <div class="keyboard-row">
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'sinh(')">sinh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'cosh(')">cosh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'tanh(')">tanh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'asinh(')">arcsinh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'acosh(')">arccosh</button>
                                            <button type="button" class="key-btn function" onclick="insertSymbolTo('r_funcion', 'atanh(')">arctanh</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="r_x">Punto x:</label>
                                <input type="number" id="r_x" class="form-control" step="any" value="1.8">
                            </div>
                            <div class="form-group">
                                <label for="r_h">Paso inicial h:</label>
                                <input type="number" id="r_h" class="form-control" step="any" value="0.1">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="r_metodo">M√©todo base:</label>
                                <select id="r_metodo" class="form-control">
                                    <option value="centrada">Diferencia Centrada</option>
                                    <option value="adelante" selected>Diferencia Hacia Adelante</option>
                                    <option value="atras">Diferencia Hacia Atr√°s</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="r_orden">Orden:</label>
                                <select id="r_orden" class="form-control">
                                    <option value="1" selected>Primera derivada</option>
                                    <option value="2">Segunda derivada</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="r_niveles">Niveles de extrapolaci√≥n:</label>
                            <select id="r_niveles" class="form-control">
                                <option value="2">2 niveles</option>
                                <option value="3" selected>3 niveles</option>
                                <option value="4">4 niveles</option>
                                <option value="5">5 niveles</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn">Aplicar Richardson</button>
                    </form>
                </div>
                
                <div id="richardsonResults" class="results" style="display: none;"></div>
            </div>
            
            <!-- TAB: INTERPOLACI√ìN -->
            <div id="interpolacion" class="tab-content">
                <div class="method-description">
                    <h3>Interpolaci√≥n Polin√≥mica</h3>
                    <p>Encuentra el polinomio que pasa por un conjunto de puntos usando los m√©todos de Lagrange o Newton. √ötil para aproximar funciones conocidas solo en puntos discretos.</p>
                </div>
                
                <div class="form-section">
                    <form id="interpolacionForm">
                        <div class="form-group">
                            <label for="i_metodo">M√©todo de interpolaci√≥n:</label>
                            <select id="i_metodo" class="form-control">
                                <option value="lagrange">Lagrange</option>
                                <option value="newton">Newton</option>
                            </select>
                        </div>
                        
                        <div class="interpolation-points">
                            <h4>Puntos (x, y):</h4>
                            <div id="pointsContainer">
                                <div class="point-input">
                                    <input type="number" step="any" placeholder="x‚ÇÅ" class="x-point" value="0">
                                    <input type="number" step="any" placeholder="y‚ÇÅ" class="y-point" value="1">
                                    <button type="button" class="remove-point" onclick="removePoint(this)">-</button>
                                </div>
                                <div class="point-input">
                                    <input type="number" step="any" placeholder="x‚ÇÇ" class="x-point" value="1">
                                    <input type="number" step="any" placeholder="y‚ÇÇ" class="y-point" value="2">
                                    <button type="button" class="remove-point" onclick="removePoint(this)">-</button>
                                </div>
                                <div class="point-input">
                                    <input type="number" step="any" placeholder="x‚ÇÉ" class="x-point" value="2">
                                    <input type="number" step="any" placeholder="y‚ÇÉ" class="y-point" value="5">
                                    <button type="button" class="remove-point" onclick="removePoint(this)">-</button>
                                </div>
                            </div>
                            <button type="button" class="add-point" onclick="addPoint()">+ Agregar Punto</button>
                        </div>
                        
                        <div class="form-group">
                            <label for="i_x_eval">Evaluar en x:</label>
                            <input type="number" id="i_x_eval" class="form-control" step="any" value="1.5">
                        </div>
                        
                        <button type="submit" class="btn">Calcular Interpolaci√≥n</button>
                    </form>
                </div>
                
                <div id="interpolacionResults" class="results" style="display: none;"></div>
            </div>
            
            
        </div>
    </div>

    <script>
        // Funci√≥n para actualizar preview matem√°tico (gen√©rica)
        function updateMathPreview(inputId, previewId) {
            inputId = inputId || 'df_funcion';
            previewId = previewId || 'math-preview';
            
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            if (!input || !preview) return;
            
            let text = input.value;
            
            if (!text) {
                preview.innerHTML = '';
                return;
            }
            
            // Convertir sintaxis Python a notaci√≥n matem√°tica
            let mathText = text
                // Ra√≠z n-√©sima primero (antes de potencias)
                .replace(/\*\*\(1\//g, '‚Åø‚àö(')
                // Potencias espec√≠ficas con super√≠ndices
                .replace(/\*\*2/g, '¬≤')
                .replace(/\*\*3/g, '¬≥')
                .replace(/\*\*4/g, '‚Å¥')
                .replace(/\*\*5/g, '‚Åµ')
                .replace(/\*\*6/g, '‚Å∂')
                .replace(/\*\*7/g, '‚Å∑')
                .replace(/\*\*8/g, '‚Å∏')
                .replace(/\*\*9/g, '‚Åπ')
                .replace(/\*\*0\.5/g, '¬Ω')
                // Potencia gen√©rica x**(algo) ‚Üí x‚ÅΩ·µÉÀ°·µç·µí‚Åæ con super√≠ndices
                .replace(/\*\*\(/g, '‚ÅΩ')
                .replace(/\*\*([0-9]+)/g, (match, num) => {
                    const superscripts = {'0':'‚Å∞','1':'¬π','2':'¬≤','3':'¬≥','4':'‚Å¥','5':'‚Åµ','6':'‚Å∂','7':'‚Å∑','8':'‚Å∏','9':'‚Åπ'};
                    return num.split('').map(d => superscripts[d] || d).join('');
                })
                // Operadores
                .replace(/\*\*/g, 'ÀÜ')
                .replace(/\*/g, '√ó')
                .replace(/\//g, '√∑')
                // Cerrar par√©ntesis de exponente
                .replace(/‚ÅΩ([^)]+)\)/g, '‚ÅΩ$1‚Åæ')
                // Funciones
                .replace(/sqrt\(/g, '‚àö(')
                .replace(/abs\(/g, '|')
                .replace(/exp\(/g, 'e^(')
                .replace(/log10\(/g, 'log‚ÇÅ‚ÇÄ(')
                .replace(/log\(/g, 'ln(')
                .replace(/factorial\(/g, '!')
                .replace(/floor\(/g, '‚åä')
                .replace(/ceil\(/g, '‚åà')
                .replace(/sign\(/g, 'sgn(')
                // Trigonom√©tricas
                .replace(/asin\(/g, 'arcsin(')
                .replace(/acos\(/g, 'arccos(')
                .replace(/atan\(/g, 'arctan(')
                .replace(/asec\(/g, 'arcsec(')
                .replace(/acsc\(/g, 'arccsc(')
                .replace(/acot\(/g, 'arccot(')
                .replace(/asinh\(/g, 'arcsinh(')
                .replace(/acosh\(/g, 'arccosh(')
                .replace(/atanh\(/g, 'arctanh(')
                // Constantes
                .replace(/\bpi\b/g, 'œÄ')
                .replace(/\bE\b/g, 'e');
            
            preview.innerHTML = mathText;
        }
        
        // Funci√≥n para colapsar/expandir secciones del teclado
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const toggle = header.querySelector('.keyboard-section-toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                toggle.classList.add('collapsed');
            }
        }
        
        // Funci√≥n para insertar s√≠mbolos en el input (legacy - para Diferencias Finitas)
        function insertSymbol(symbol) {
            insertSymbolTo('df_funcion', symbol);
        }
        
        // Funci√≥n gen√©rica para insertar s√≠mbolos en cualquier input
        function insertSymbolTo(inputId, symbol) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            input.value = text.substring(0, start) + symbol + text.substring(end);
            input.selectionStart = input.selectionEnd = start + symbol.length;
            input.focus();
            
            // Actualizar preview correspondiente
            const previewMap = {
                'df_funcion': 'math-preview',
                'r_funcion': 'r_math-preview',
                'di_funcion': 'di_math-preview'
            };
            if (previewMap[inputId]) {
                updateMathPreview(inputId, previewMap[inputId]);
            }
        }
        
        // Funci√≥n para borrar un car√°cter (legacy - para Diferencias Finitas)
        function deleteChar() {
            deleteCharFrom('df_funcion');
        }
        
        // Funci√≥n gen√©rica para borrar un car√°cter
        function deleteCharFrom(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const start = input.selectionStart;
            const end = input.selectionEnd;
            if (start === end && start > 0) {
                input.value = input.value.substring(0, start - 1) + input.value.substring(end);
                input.selectionStart = input.selectionEnd = start - 1;
            } else if (start !== end) {
                input.value = input.value.substring(0, start) + input.value.substring(end);
                input.selectionStart = input.selectionEnd = start;
            }
            input.focus();
            
            // Actualizar preview correspondiente
            const previewMap = {
                'df_funcion': 'math-preview',
                'r_funcion': 'r_math-preview',
                'di_funcion': 'di_math-preview'
            };
            if (previewMap[inputId]) {
                updateMathPreview(inputId, previewMap[inputId]);
            }
        }
        
        // Funci√≥n para limpiar el input (legacy - para Diferencias Finitas)
        function clearInput() {
            clearInputFor('df_funcion');
        }
        
        // Funci√≥n gen√©rica para limpiar el input
        function clearInputFor(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            input.value = '';
            input.focus();
            
            // Actualizar preview correspondiente
            const previewMap = {
                'df_funcion': 'math-preview',
                'r_funcion': 'r_math-preview',
                'di_funcion': 'di_math-preview'
            };
            if (previewMap[inputId]) {
                updateMathPreview(inputId, previewMap[inputId]);
            }
        }
        
        // Funci√≥n para cambiar pesta√±as
        function showTab(tabName) {
            // Ocultar todas las pesta√±as
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remover active de botones
            const buttons = document.querySelectorAll('.nav-tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Mostrar pesta√±a seleccionada
            document.getElementById(tabName).classList.add('active');
            
            // Activar bot√≥n correspondiente
            event.target.classList.add('active');
        }
        
        // Gesti√≥n de puntos para interpolaci√≥n
        function addPoint() {
            const container = document.getElementById('pointsContainer');
            const pointNum = container.children.length + 1;
            const div = document.createElement('div');
            div.className = 'point-input';
            div.innerHTML = `
                <input type="number" step="any" placeholder="x${pointNum}" class="x-point">
                <input type="number" step="any" placeholder="y${pointNum}" class="y-point">
                <button type="button" class="remove-point" onclick="removePoint(this)">-</button>
            `;
            container.appendChild(div);
        }
        
        function removePoint(button) {
            const container = document.getElementById('pointsContainer');
            if (container.children.length > 2) {
                button.parentElement.remove();
            }
        }
        
        // Funci√≥n para mostrar loading
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.style.display = 'block';
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Calculando...</p>
                </div>
            `;
        }
        
        // Funci√≥n para mostrar resultados
        function showResults(containerId, data) {
            const container = document.getElementById(containerId);
            
            if (data.success) {
                let html = `
                    <div class="result-title">Resultado</div>
                    <div class="result-value">${data.resultado}</div>
                `;
                
                if (data.pasos && data.pasos.length > 0) {
                    html += `
                        <div class="steps">
                            <h4>Pasos del c√°lculo:</h4>
                    `;
                    
                    data.pasos.forEach(paso => {
                        html += `<div class="step">${paso}</div>`;
                    });
                    
                    html += `</div>`;
                }
                
                container.innerHTML = html;
            } else {
                container.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${data.error}
                    </div>
                `;
            }
        }
        
        // Eventos de formularios
        document.getElementById('diferenciasForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                funcion: document.getElementById('df_funcion').value,
                x: document.getElementById('df_x').value,
                h: document.getElementById('df_h').value,
                metodo: document.getElementById('df_metodo').value,
                orden: document.getElementById('df_orden').value
            };
            
            showLoading('diferenciasResults');
            
            try {
                const response = await fetch('/diferencias_finitas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showResults('diferenciasResults', result);
            } catch (error) {
                showResults('diferenciasResults', {
                    success: false,
                    error: 'Error de conexi√≥n: ' + error.message
                });
            }
        });
        
        document.getElementById('richardsonForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                funcion: document.getElementById('r_funcion').value,
                x: document.getElementById('r_x').value,
                h: document.getElementById('r_h').value,
                metodo: document.getElementById('r_metodo').value,
                orden: document.getElementById('r_orden').value,
                niveles: document.getElementById('r_niveles').value
            };
            
            showLoading('richardsonResults');
            
            try {
                const response = await fetch('/richardson', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showResults('richardsonResults', result);
            } catch (error) {
                showResults('richardsonResults', {
                    success: false,
                    error: 'Error de conexi√≥n: ' + error.message
                });
            }
        });
        
        document.getElementById('interpolacionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const xPoints = Array.from(document.querySelectorAll('.x-point')).map(input => input.value);
            const yPoints = Array.from(document.querySelectorAll('.y-point')).map(input => input.value);
            
            const data = {
                metodo: document.getElementById('i_metodo').value,
                x_puntos: xPoints,
                y_puntos: yPoints,
                x_eval: document.getElementById('i_x_eval').value
            };
            
            showLoading('interpolacionResults');
            
            try {
                const response = await fetch('/interpolacion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showResults('interpolacionResults', result);
            } catch (error) {
                showResults('interpolacionResults', {
                    success: false,
                    error: 'Error de conexi√≥n: ' + error.message
                });
            }
        });
        
        // Derivada por Interpolaci√≥n removed from UI; related event listener omitted.
        
        // Inicializar preview matem√°tico al cargar la p√°gina
        window.addEventListener('DOMContentLoaded', function() {
            updateMathPreview('df_funcion', 'math-preview');
            updateMathPreview('r_funcion', 'r_math-preview');
        });
    </script>
</body>
</html>